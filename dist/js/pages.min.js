/*
Comecero Popup Cart version: ï»¿1.0.3
https://comecero.com
https://github.com/comecero/cart
Copyright Comecero and other contributors. Released under MIT license. See LICENSE for details.
*/

app.directive("ccExpDate",function(){return{restrict:"A",scope:{date:"=?",expMonth:"=?",expYear:"=?"},link:function(e,t,r){var o=!1;document.addEventListener("keydown",function(e){o=8==e.which||46==e.which}),e.$watch("date",function(t,r){if(t!=r){if(!t)return void(e.date=null);if("1/"==t)return void(e.date="01 / ");if(o)return" /"==utils.right(t,2)?void(e.date=utils.left(t,t.length-2)):void(e.date=t);var i="";t&&(i=t.replace(/[^0-9]/g,"")),1==i.length&&/[2-9]/.test(i)&&(i="0".concat(i)),2==i.length&&/[3-9]/.test(utils.right(i,1))&&(i+=" / "),i.length>=2&&"/ "!=utils.right(i,2)&&(i=i.substring(0,2)+" / "+utils.right(i,i.length-2)),i.length>=9&&(i=utils.left(i,9)),e.date=i,i.length>=2&&(e.expMonth=i.substring(0,2)),7==i.length&&(e.expYear=utils.right(i,2))}})}}}),app.directive("postalCodePlaceholder",["gettextCatalog",function(e){return{restrict:"A",scope:{postalCodePlaceholder:"=?",country:"=?"},link:function(t,r,o){t.$watch("country",function(r,o){"US"==r?t.postalCodePlaceholder="ZIP":t.postalCodePlaceholder=e.getString("Postal Code")})}}}]),app.directive("downloadReceipt",["ApiService",function(e){return{restrict:"A",scope:{orderId:"=?",orderUrl:"=?",error:"=?"},link:function(t,r,o){r.bind("click",function(){e.getItemPdf(t.orderUrl).then(function(e){var r=new Blob([e.data],{type:"application/pdf"});saveAs(r,"Order_"+t.orderId+".pdf")},function(e){t.error=e})})}}}]),app.directive("insertHtml",function(){return{restrict:"AE",link:function(e,t,r){},templateUrl:function(e,t){return t.insertHtml}}}),app.controller("IndexController",["$scope","ApiService","SettingsService",function(e,t,r){window.location="getting-started"}]),app.controller("SimpleDesktopController",["$scope","CartService","GeoService","CurrencyService","SettingsService","HelperService","$uibModal","$timeout","gettextCatalog","$location","$document",function(e,t,r,o,i,a,n,s,d,c,p){e.data={},e.geoService=r,e.settings=i.get(),e.helpers=a,e.options={showSpinner:!1},e.paymentParams={expand:"payment_method,payment_method.data,order.customer,order.items.product,order.items.subscription,order.options,cart.options,invoice.options",show:"payment_method.*,payment_method.data.*,date_created,order.order_id,order.subtotal,order.total,order.tax,order.discount,order.currency,order.customer.name,order.tax_inclusive,order.customer.customer_id,order.customer.email,order.customer.username,order.customer.billing_address.*,order.items.item_id,order.items.quantity,order.items.price,order.items.price_original,order.items.subtotal,order.items.subtotal_original,order.items.total,order.items.total_original,order.items.name,order.items.subscription.description,order.shipping_item.quantity,order.shipping_item.name,order.shipping_item.price,order.shipping_item.price_original,order.shipping_item.subtotal,order.shipping_item.subtotal_original,order.shipping_item.total,order.shipping_item.total_original,order.items.product.images.link_square,order.options.customer_optional_fields,order,cart.options.*,invoice.options.customer_optional_fields"},e.data.params={},e.data.params.expand="items.product,items.subscription_terms,customer.payment_methods,options",e.data.params.hide="items.product.formatted,items.product.prices,items.product.url,items.product.description,items.product.images.link_small,items.product.images.link_medium,items.product.images.link_large,items.product.images.link,items.product.images.filename,items.product.images.formatted,items.product.images.url,items.product.images.date_created,items.product.images.date_modified",e.data.payment_method={},e.data.header_image=e.settings.app.logo_popup_square||"images/default_popup_icon.png",e.data.card={type:"credit_card"},e.data.paypal={type:"paypal",data:{success_url:window.location.href.substring(0,window.location.href.indexOf("#"))+"#/simple-d/review/{{payment_id}}",cancel_url:i.get().app.main_shopping_url||localStorage.getItem("parent_url")}};var m=function(r){l(),r.items=r.items||[{}],e.data.cart&&e.data.cart.items&&e.data.cart.items[0]&&e.data.cart.items[0].product_id!=r.items[0].product_id&&e.$apply(function(){e.data.cart.items=null}),t.update(r,e.data.params,!0).then(function(t){e.data.cart=t,u(),g(),e.settings.app.use_product_icon&&t.items[0].product.images[0]&&(e.data.header_image=t.items[0].product.images[0].link_square),sendMessage({type:"on_load",cart:t},e.settings.app.allowed_origin_hosts),0==t.options.payment_methods.length&&(e.data.error={message:"No payment methods are available for the selected currency."})},function(t){e.data.error=t,u(),g()})};e.onPaymentSuccess=function(t){switch(t.payment_method.type){case"paypal":sendMessage({type:"redirect",url:t.response_data.redirect_url},e.settings.app.allowed_origin_hosts);break;default:e.data.payment=t,h(),window.__conversion&&window.__conversion.recordConversion&&window.__conversion.recordConversion(t.order.order_id)}};var l=function(){e.spinnerTimeout=s(function(){e.options.showSpinner=!0},300)},u=function(){s.cancel(e.spinnerTimeout),s(function(){e.options.showSpinner=!1},300)},_=function(){e.data.card={type:"credit_card"},e.data.exp=null,e.data.error=null,sendMessage({type:"close",cart:e.data.cart},e.settings.app.allowed_origin_hosts),e.data.payment&&(e.data.payment=null)};e.close=function(){e.modalInstance.close()};var g=function(){window.__pageview&&window.__pageview.recordPageLoad&&window.__pageview.recordPageLoad(),e.modalInstance=n.open({templateUrl:"app/pages/simple/checkout.html",backdrop:!1,scope:e}),e.modalInstance.result.then(function(){_()},function(e){_()})},h=function(){var e=document.getElementsByClassName("modal");e&&e.length&&(e[0].scrollTop=0)};e.$watch("data.error",function(t,r){e.data.error&&h()}),e.$on("messageReceived",function(e,t){(t.type=t.cart)&&m(JSON.parse(t.cart))})}]),app.controller("SimpleMobileController",["$scope","CartService","GeoService","CurrencyService","SettingsService","HelperService","$uibModal","$timeout","gettextCatalog","$location","$document",function(e,t,r,o,i,a,n,s,d,c,p){function m(){e.spinnerTimeout=s(function(){e.options.showSpinner=!0},300)}function l(){e.options.showSpinner=!1,s.cancel(e.spinnerTimeout)}e.data={},e.geoService=r,e.settings=i.get(),e.helpers=a,e.options={showSpinner:!1,showModal:!1},e.paymentParams={expand:"payment_method,payment_method.data,order.customer,order.items.product,order.items.subscription,order.options,cart.options,invoice.options",show:"payment_method.*,payment_method.data.*,date_created,order.order_id,order.subtotal,order.total,order.tax,order.discount,order.currency,order.customer.name,order.tax_inclusive,order.customer.customer_id,order.customer.email,order.customer.username,order.customer.billing_address.*,order.items.item_id,order.items.quantity,order.items.price,order.items.price_original,order.items.subtotal,order.items.subtotal_original,order.items.total,order.items.total_original,order.items.name,order.items.subscription.description,order.shipping_item.quantity,order.shipping_item.name,order.shipping_item.price,order.shipping_item.price_original,order.shipping_item.subtotal,order.shipping_item.subtotal_original,order.shipping_item.total,order.shipping_item.total_original,order.items.product.images.link_square,order.options.customer_optional_fields,order,cart.options.*,invoice.options.customer_optional_fields"},e.data.params={},e.data.params.expand="items.product,items.subscription_terms,customer.payment_methods,options",e.data.params.hide="items.product.formatted,items.product.prices,items.product.url,items.product.description,items.product.images.link_small,items.product.images.link_medium,items.product.images.link_large,items.product.images.link,items.product.images.filename,items.product.images.formatted,items.product.images.url,items.product.images.date_created,items.product.images.date_modified",e.data.payment_method={},e.data.header_image=e.settings.app.logo_popup_square||"images/default_popup_icon.png",e.data.card={type:"credit_card"},e.data.paypal={type:"paypal",data:{success_url:window.location.href.substring(0,window.location.href.indexOf("#"))+"#/simple-m/review/{{payment_id}}",cancel_url:i.get().app.main_shopping_url||localStorage.getItem("parent_url")}},m(),window.__pageview&&window.__pageview.recordPageLoad&&window.__pageview.recordPageLoad(),cart=c.search().cart,cart?(cart=JSON.parse(cart),c.search("cart",null)):cart=t.fromParams({},c),t.update(cart,e.data.params).then(function(t){e.data.cart=t,l(),e.options.showModal=!0,sendMessage({type:"on_load",cart:t},e.settings.app.allowed_origin_hosts),0==t.options.payment_methods.length&&(e.data.error={message:"No payment methods are available for the selected currency."})},function(t){e.data.error=t}),e.onPaymentSuccess=function(t){switch(t.payment_method.type){case"paypal":window.location=t.response_data.redirect_url;break;default:e.data.payment=t,p.scrollTop(0,500),window.__conversion&&window.__conversion.recordConversion&&window.__conversion.recordConversion(t.order.order_id)}};var u=function(){sendMessage({type:"close",cart:e.data.cart},e.settings.app.allowed_origin_hosts)};e.close=function(){window.close()},window.onbeforeunload=function(){u()},e.$watch("data.error",function(t,r){e.data.error&&p.scrollTop(0,500)})}]),app.controller("ReviewController",["$scope","$location","$routeParams","CartService","PaymentService","SettingsService","HelperService","GeoService","$document","$uibModal","ApiService",function(e,t,r,o,i,a,n,s,d,c,p){e.data={},e.options={},e.data.payment_id=r.id,e.settings=a.get(),e.helpers=n,e.geoService=s,e.data.header_image=e.settings.app.logo_popup_square||"images/default_popup_icon.png",a.get().app.main_shopping_url?e.data.return_url=a.get().app.main_shopping_url:localStorage.getItem("parent_url")&&(e.data.return_url=localStorage.getItem("parent_url")),e.data.params={},e.data.params.expand="cart.items.product,cart.items.subscription_terms,invoice.items.product,invoice.items.subscription_terms,cart.options,invoice.options,order.customer",e.data.params.hide="cart.items.product.formatted,cart.items.product.prices,cart.items.product.url,cart.items.product.description,cart.items.product.images.link_small,cart.items.product.images.link_medium,cart.items.product.images.link_large,cart.items.product.images.link,cart.items.product.images.filename,cart.items.product.images.formatted,cart.items.product.images.url,cart.items.product.images.date_created,cart.items.product.images.date_modified,invoice.items.product.formatted,invoice.items.product.prices,invoice.items.product.url,invoice.items.product.description,invoice.items.product.images.link_small,invoice.items.product.images.link_medium,invoice.items.product.images.link_large,invoice.items.product.images.link,invoice.items.product.images.filename,invoice.items.product.images.formatted,invoice.items.product.images.url,invoice.items.product.images.date_created,invoice.items.product.images.date_modified",e.data.saleParams={expand:utils.deDuplicateCsv(e.data.params.expand.replaceAll("cart.","").replaceAll("invoice.","")),hide:utils.deDuplicateCsv(e.data.params.hide.replaceAll("cart.","").replaceAll("invoice.",""))},i.get(e.data.payment_id,e.data.params).then(function(t){"completed"==t.status&&(e.data.payment=t),e.data.sale=t.cart||t.invoice,t.cart&&(e.options.isCartPayment=!0),e.data.sale=t.cart||t.invoice,n.isRequiredCustomerField("company_name",e.data.sale.options)&&null==e.data.sale.customer.company_name&&(e.options.showCompanyName=!0),n.isRequiredCustomerField("phone",e.data.sale.options)&&null==e.data.sale.customer.phone&&(e.options.showPhone=!0)},function(t){e.data.error=t}),e.onPaymentSuccess=function(t){t.response_data.redirect_url?window.location.replace(t.response_data.redirect_url):(e.data.payment=t,window.__conversion&&window.__conversion.recordConversion&&window.__conversion.recordConversion(t.order.order_id))},e.$watch("data.error",function(t,r){e.data.error&&d.scrollTop(0,500)}),e.downloadReceipt=function(){p.getItemPdf(e.data.payment.order.url).then(function(t){var r=new Blob([t.data],{type:"application/pdf"});saveAs(r,"Order_"+e.data.payment.order.order_id+".pdf")},function(t){e.exception.error=t})},e.close=function(){"review"==t.path()||(window.location=e.data.return_url)},window.__pageview&&window.__pageview.recordPageLoad&&window.__pageview.recordPageLoad()}]);