/*
Comecero Popup Cart version: ï»¿1.0.7
https://comecero.com
https://github.com/comecero/cart
Copyright Comecero and other contributors. Released under MIT license. See LICENSE for details.
*/

var _popup=function(){function e(e,n,o){t("The tab is being opened.");var a=encodeURIComponent(JSON.stringify(e)),r=n+"?cart="+a;o&&(r+="&language="+o),i=window.open(r),d({type:"set_parent_url",url:window.location.href})}function t(e,t){l&&(t?console.log("debug: "+e+": "+t):console.log("debug: "+e))}var i,n,o,a,r,s,l;!function(e){var t=/iPhone/i,i=/iPod/i,n=/iPad/i,o=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,a=/Android/i,r=/(?=.*\bAndroid\b)(?=.*\bSD4930UR\b)/i,s=/(?=.*\bAndroid\b)(?=.*\b(?:KFOT|KFTT|KFJWI|KFJWA|KFSOWI|KFTHWI|KFTHWA|KFAPWI|KFAPWA|KFARWI|KFASWI|KFSAWI|KFSAWA)\b)/i,l=/Windows Phone/i,d=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,p=/BlackBerry/i,c=/BB10/i,u=/Opera Mini/i,h=/(CriOS|Chrome)(?=.*\bMobile\b)/i,f=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,g=new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i"),m=function(e,t){return e.test(t)},b=function(e){var b=e||navigator.userAgent,w=b.split("[FBAN");if("undefined"!=typeof w[1]&&(b=w[0]),w=b.split("Twitter"),"undefined"!=typeof w[1]&&(b=w[0]),this.apple={phone:m(t,b),ipod:m(i,b),tablet:!m(t,b)&&m(n,b),device:m(t,b)||m(i,b)||m(n,b)},this.amazon={phone:m(r,b),tablet:!m(r,b)&&m(s,b),device:m(r,b)||m(s,b)},this.android={phone:m(r,b)||m(o,b),tablet:!m(r,b)&&!m(o,b)&&(m(s,b)||m(a,b)),device:m(r,b)||m(s,b)||m(o,b)||m(a,b)},this.windows={phone:m(l,b),tablet:m(d,b),device:m(l,b)||m(d,b)},this.other={blackberry:m(p,b),blackberry10:m(c,b),opera:m(u,b),firefox:m(f,b),chrome:m(h,b),device:m(p,b)||m(c,b)||m(u,b)||m(f,b)||m(h,b)},this.seven_inch=m(g,b),this.any=this.apple.device||this.android.device||this.windows.device||this.other.device||this.seven_inch,this.phone=this.apple.phone||this.android.phone||this.windows.phone,this.tablet=this.apple.tablet||this.android.tablet||this.windows.tablet,"undefined"==typeof window)return this},w=function(){var e=new b;return e.Class=b,e};"undefined"!=typeof module&&module.exports&&"undefined"==typeof window?module.exports=b:"undefined"!=typeof module&&module.exports&&"undefined"!=typeof window?module.exports=w():"function"==typeof define&&define.amd?define("isMobile",[],e.isMobile=w()):e.isMobile=w()}(this),r=!isMobile.phone;var d=function(e){var n=window.__settings||{},a="This app is not properly configured to run from this website. To enable the payment window to launch from this website, you must supply the website hostname as an allowed origin in the app settings.";if(a+="\n\nTo configure the payment window to run from this website, sign in to your account, navigate to Apps, go to the settings for the app and add "+window.location.hostname+" to the list of allowed websites.","localhost"!=window.location.hostname&&"127.0.0.1"!=window.location.hostname&&window.location.protocol+"//"+window.location.hostname!=o){if(!n.app||!n.app.allowed_origin_hosts)return t("Send message failed. The parent hostname is not listed in allowed_origin_hosts (check 1)",window.location.hostname),alert(a),void c();var r=n.app.allowed_origin_hosts.split(/[\n\s,]+/);if(r.indexOf(window.location.hostname)==-1)return t("Send message failed. The parent hostname is not listed in allowed_origin_hosts (check 2)",window.location.hostname),alert(a),void c()}if(t("Preparing to send a message",JSON.stringify(e)),s)t("The iframe is ready, sending message now."),i.postMessage(JSON.stringify(e),o);else var l=setInterval(function(){t("Checking to see if the iframe is ready before attempting to send the message."),s&&(t("The iframe is ready, sending message now (from interval)."),clearInterval(l),i.postMessage(JSON.stringify(e),o))},20)};window.addEventListener("message",function(e){if(e.data){if(t("Received message from app",JSON.stringify(e)),e.origin!=o)return void console.log("Attempting to receive a message from the child window that is not hosted by an allowed hostname: The hostname "+e.origin+" is not listed as approved in the app settings. The message will be ignored.");var i=JSON.parse(e.data);if("close"==i.type&&(n&&(t("Preparing to close the iframe."),c()),_popup.onClose)){var a={cart:i.cart,order:i.order};t("Calling the onClose event.",JSON.stringify(a)),_popup.onClose(a)}if("on_load"==i.type&&_popup.onLoad){var a={cart:i.cart};t("Calling onLoad event.",JSON.stringify(a)),_popup.onLoad(a)}"redirect"==i.type&&(t("The app is requesting the parent page to perform a redirect.",i.url),window.location=i.url),"ready"==i.type&&(t("The app is indicating that it is ready."),s=!0)}});var p=function(e){t("Opening the iframe",JSON.stringify(e)),n.style.display="block",d({type:"add_to_cart",cart:JSON.stringify(e)}),d({type:"set_parent_url",url:window.location.href})},c=function(){t("Closing the iframe"),setTimeout(function(){document.getElementById("_popup_iframe").style.display="none"},250)},u=function(e,i){t("Adding the app script to the page",e);var n=document.getElementsByTagName("head")[0],o=!1,a=document.createElement("script");a.src=e,a.type="text/javascript",a.async=1,a.onload=a.onreadystatechange=function(){o||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(o=!0,"function"==typeof i&&i())},n.appendChild(a)},h=function(e){t("Creating the cart from JSON attributes",JSON.stringify(e));var i={},n=e.getAttribute("data-cart");if(n){try{i=JSON.parse(n)}catch(e){console.log("The value of data-cart in the popup button must contain valid JSON. Attempting to parse the value supplied resulted in an error: "+e)}return i}for(var o=0,a=e.attributes,r=a.length;o<r;o++)if(a[o].nodeName.length>=5&&"data-"==a[o].nodeName.substring(0,5)){var s=e.getAttribute(a[o].nodeName),l=a[o].nodeName.replace("data-","");if("meta-"==l.substring(0,5)){var d=l.substring(5);i.meta=i.meta||{},i.meta[d]=s}else"name"==l||"email"==l?(i.customer=i.customer||{},i.customer[l]=s):"product_id"==l?(i.items=i.items||[{}],i.items[0].product_id=s):"quantity"==l?(i.items=i.items||[{}],i.items[0].quantity=s||1):i[l]=s}return i},f=function(e){var i=setInterval(function(){if(t("Preparing to look for clickables, will repeat until the body has finished loading."),"complete"===document.readyState){clearInterval(i);var n=document.getElementsByClassName("popup-buy-now");t("The clickables have been loaded."),e(n)}},20)},g=function(e,o){t("Adding modal listeners",e),n=document.createElement("iframe"),n.src=e,o&&(n.src+="?language="+o),n.setAttribute("id","_popup_iframe"),n.setAttribute("frameborder",0),n.setAttribute("scrolling","no"),n.setAttribute("allowtransparency",!0),n.setAttribute("sandbox","allow-scripts allow-forms allow-same-origin allow-popups"),n.style.display="none",n.style["z-index"]=2147483647,n.style.background="rgba(0, 0, 0, 0.004)",n.style.border="0px none transparent",n.style["overflow-x"]="hidden",n.style["overflow-y"]="auto",n.style.visibility="visible",n.style.margin="0px",n.style.padding="0px",n.style["-webkit-tap-highlight-color"]="transparent",n.style.position="fixed",n.style.left="0px",n.style.top="0px",n.style.width="100%",n.style.height="100%",document.body.appendChild(n),t("The iframe has been appended to the parent window"),i=document.getElementById("_popup_iframe").contentWindow,f(function(e){for(var i=0;i<e.length;i++)e[i].addEventListener("click",function(e){t("A clickable has been clicked and the iframe will be opened."),e.preventDefault(),p(h(e.currentTarget))})})},m=function(i,n){f(function(o){for(var a=0;a<o.length;a++)o[a].addEventListener("click",function(o){t("A clickable has been clicked and a new tab will be opened."),o.preventDefault();var a=h(o.currentTarget);e(a,i,n)})})},b=function(i,n){readyCallback=i,n&&(l=!0),t("Initialization started."),t("Has a callback been provided?",null!=i?"Yes":"No");var s=document.getElementById("_popup_script");if(s){var d=s.getAttribute("src"),c=d.split("/").slice(-3);a=d.substring(0,d.length-c.join("/").length);var h=s.getAttribute("data-popup-type")||"simple";t("type",h);var f=s.getAttribute("data-popup-ui")||"basic";t("ui",f);var b=s.getAttribute("data-language");t("language",b||"not specified, will use default language for user");var w=s.getAttribute("data-as-modal");w&&("true"===w&&(r=!0),"false"===w&&(r=!1)),t("Will the app be served as a modal?",r?"Yes":"No");var y=a+"#/"+h;r&&(y+="-mod");for(var v=-1,_=3;_--&&v++<d.length&&(v=d.indexOf("/",v),!(v<0)););o=d.substring(0,v),"https://"!=d.substring(0,8)&&"http://"!=d.substring(0,8)&&(o=window.location.protocol+"//"+window.location.hostname),t("childOrigin",o),u(a+"settings/app.js",function(){if(r)var n=setInterval(function(){document.body&&(g(y,b),clearInterval(n),_popup.open=function(e){t("Modal launched based on open() call from parent page."),p(e)},i&&(t("Callback from initialize will be fired."),i()))},20);else m(y,b),_popup.open=function(i){t("Modal launched based on open() call from parent page."),e(i,y,b)},i&&(t("Callback from initialize will be fired."),i())})}else console.warn('The script tag that loads popup.js must contain the attribute id="_popup_script"')};return{initialize:b}}();!function(){function e(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),n=i.exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}var t=document.getElementById("_popup_script");if(t&&!t.getAttribute("data-self-init")){var i=!1;null!=t.getAttribute("data-debug")&&"true"===t.getAttribute("data-debug")&&(i=!0),"true"===e("debug")&&(i=!0),_popup.initialize(null,i)}}();