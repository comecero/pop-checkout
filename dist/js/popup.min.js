/*
Comecero Popup Cart version: ï»¿1.0
https://comecero.com
https://github.com/comecero/cart
Copyright Comecero and other contributors. Released under MIT license. See LICENSE for details.
*/

var _popup=function(){var t,e,o,n,i,a=function(e){var n="This app is not properly configured to run from this website. To enable the payment window to launch from this website, you must supply the website hostname as an allowed origin in the app settings.";n+="\n\nTo configure the payment window to run from this website, sign in to your account, navigate to Apps, go to the settings for the app and add "+window.location.hostname+" to the list of allowed websites.";var i=window.__settings||{};if("localhost"!=window.location.hostname&&"127.0.0.1"!=window.location.hostname&&window.location.protocol+"//"+window.location.hostname!=o){if(!i.app||!i.app.allowed_origin_hosts)return alert(n),void r();var a=i.app.allowed_origin_hosts.split(/[\n\s,]+/);if(a.indexOf(window.location.hostname)==-1)return alert(n),void r()}t.postMessage(JSON.stringify(e),o)};window.addEventListener("message",function(t){if(t.data){if(t.origin!=o)return void console.log("Attempting to receive a message from the iframe window that is not hosted by an allowed hostname: The hostname "+originHost+" is not listed as approved in the app settings. The message will be ignored.");var e=JSON.parse(t.data);"close"==e.type&&r(e.cart),"on_load"==e.type&&_popup.onLoad&&_popup.onLoad(e.cart),"redirect"==e.type&&(window.location=e.url)}});var s=function(t){e.style.display="block",a({type:"add_to_cart",cart:JSON.stringify(t)}),a({type:"set_parent_url",url:window.location.href})},r=function(t){setTimeout(function(){document.getElementById("_popup_iframe").style.display="none"},250),_popup.onClose&&_popup.onClose(t)},l=function(t){var e={},o=t.getAttribute("data-cart");if(o){try{e=JSON.parse(o)}catch(t){console.log("The value of data-cart in the popup button must contain valid JSON. Attempting to parse the value supplied resulted in an error: "+t)}return e}for(var n=0,i=t.attributes,a=i.length;n<a;n++)if(i[n].nodeName.length>=5&&"data-"==i[n].nodeName.substring(0,5)){var s=t.getAttribute(i[n].nodeName),r=i[n].nodeName.replace("data-","");if("meta-"==r.substring(0,5)){var l=r.substring(5);e.meta=e.meta||{},e.meta[l]=s}else"name"==r||"email"==r?(e.customer=e.customer||{},e.customer[r]=s):"product_id"==r?(e.items=e.items||[{}],e.items[0].product_id=s):"quantity"==r?(e.items=e.items||[{}],e.items[0].quantity=s||1):e[r]=s}return e},p=function(t,e){var o=document.createElement("script");o.src=t;var n=document.getElementsByTagName("head")[0],i=!1;o.onload=o.onreadystatechange=function(){i||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(i=!0,e&&e(),o.onload=o.onreadystatechange=null,n.removeChild(o))},n.appendChild(o)},d=function(){var a=document.getElementById("_popup_script");if(a){n=a.getAttribute("src");for(var r=-1,d=3;d--&&r++<n.length&&(r=n.indexOf("/",r),!(r<0)););o=n.substring(0,r),"https://"==n.substring(0,8)||"http://"==n.substring(0,8)?i=n.substring(0,n.split("/",4).join("/").length):(i=n.substring(0,n.split("/",1).join("/").length),o=window.location.protocol+"//"+window.location.hostname),p(i+"/settings/app.js");var u=a.getAttribute("data-popup-type")||"simple";e=document.createElement("iframe"),e.src=i+"/#/"+u,e.setAttribute("id","_popup_iframe"),e.setAttribute("frameborder",0),e.setAttribute("scrolling","no"),e.setAttribute("allowtransparency",!0),e.setAttribute("sandbox","allow-scripts allow-forms allow-same-origin allow-popups"),e.style.display="none",e.style["z-index"]=2147483647,e.style.background="rgba(0, 0, 0, 0.004)",e.style.border="0px none transparent",e.style["overflow-x"]="hidden",e.style["overflow-y"]="auto",e.style.visibility="visible",e.style.margin="0px",e.style.padding="0px",e.style["-webkit-tap-highlight-color"]="transparent",e.style.position="fixed",e.style.left="0px",e.style.top="0px",e.style.width="100%",e.style.height="100%";var c=function(){document.body.appendChild(e),t=document.getElementById("_popup_iframe").contentWindow;for(var o=document.getElementsByClassName("popup-buy-now"),n=0;n<o.length;n++)o[n].addEventListener("click",function(t){t.preventDefault(),s(l(t.target))})},m=setInterval(function(){document.body&&(c(),clearInterval(m))},20)}else console.warn('The script tag that loads popup.js must contain the attribute id="_popup_script"')};return{initialize:d,open:s,close:r}}();_popup.initialize();